generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider             = "mysql"
  url                  = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

model Characters {
  id                     Int          @id @default(autoincrement())
  name                   String
  physicalDescription    String?      @db.Text
  personalityDescription String?      @db.Text
  characterHistory       String       @db.Text
  price                  Float?
  dtStart                DateTime?
  dtEnd                  DateTime?
  UsersCards             UsersCards[]
  Cart                   Cart[]

  @@unique([id])
  @@index([id])
}

model User {
  id         Int          @id @default(autoincrement())
  username   String
  name       String
  email      String
  dtEnd      DateTime?
  cartId     Int          @unique
  UsersCards UsersCards[]
  Purchases  Purchases[]
  Cart       Cart[]

  @@unique([id, cartId, email, username])
  @@index([id])
}

model Cart {
  id          Int        @id @default(autoincrement())
  cart        User       @relation(fields: [id], references: [cartId], onUpdate: Cascade, onDelete: Cascade)
  character   Characters @relation(fields: [characterId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  characterId Int
  added_dt    DateTime   @default(now())

  @@index([id])
}

model Purchases {
  userId         Int      @id
  user           User     @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  dtPurchased    DateTime @default(now())
  purchaseAmount Float

  @@index([userId])
}

model UsersCards {
  usersCardsId Int        @id @default(autoincrement())
  user         User       @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  userId       Int
  character    Characters @relation(fields: [characterId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  characterId  Int

  @@unique([userId, characterId])
  @@index([usersCardsId])
}

model Newsletter {
  newsletterId Int    @id @default(autoincrement())
  email        String @unique
}
